<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title id="pageTitle">Cole√ß√£o - Stranger Things Store</title>
    <link rel="preload" href="logo.png" as="image">
    <link rel="stylesheet" href="styles.css?v=18">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@300;400;500;600;700&family=display=swap"
        rel="stylesheet">

    <style>
        /* CSS CR√çTICO INLINE - FOR√áAR desde o in√≠cio */
        body:has(.announcement-bar:not(.hidden)),
        body.has-announcement {
            padding-top: 48px !important;
        }

        /* Header SEMPRE abaixo do announcement bar */
        body:has(.announcement-bar:not(.hidden)) .header,
        body.has-announcement .header,
        .announcement-bar:not(.hidden)~.header {
            top: 48px !important;
            z-index: 1003 !important;
        }

        /* Announcement bar SEMPRE no topo */
        .announcement-bar:not(.hidden) {
            position: fixed !important;
            top: 0 !important;
            z-index: 1004 !important;
            height: 48px !important;
        }

        /* Collection page specific styles */
        .collection-header {
            /* Espa√ßamento superior considerando header (60px) + espa√ßo */
            padding-top: 100px;
            padding-bottom: var(--spacing-2xl);
            padding-left: var(--spacing-md);
            padding-right: var(--spacing-md);
            background: linear-gradient(135deg, rgba(229, 9, 20, 0.1) 0%, rgba(0, 0, 0, 0.9) 100%);
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }

        /* Quando h√° announcement bar */
        body.has-announcement .collection-header {
            padding-top: 120px;
        }

        .collection-title {
            font-family: var(--font-teko);
            font-size: var(--fs-4xl);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: var(--spacing-md);
            color: var(--netflix-red);
            text-shadow: 0 0 20px rgba(229, 9, 20, 0.8);
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .collection-description {
            font-size: var(--fs-lg);
            color: var(--text-gray);
            max-width: 700px;
            margin: 0 auto var(--spacing-md);
            line-height: 1.6;
        }

        .collection-count {
            font-family: var(--font-teko);
            font-size: var(--fs-xl);
            color: var(--text-white);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-family: var(--font-teko);
            font-size: var(--fs-base);
            color: var(--text-gray);
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--spacing-lg);
            transition: all var(--transition-base);
        }

        .back-link:hover {
            color: var(--netflix-red);
        }

        .back-link svg {
            width: 20px;
            height: 20px;
        }

        .collection-products-section {
            padding: var(--spacing-2xl) var(--spacing-md);
        }

        /* Mobile adjustments */
        @media (max-width: 768px) {
            .collection-header {
                padding-top: 80px;
            }

            body.has-announcement .collection-header {
                padding-top: 100px;
            }

            .collection-title {
                font-size: var(--fs-3xl);
                letter-spacing: 2px;
            }

            .collection-description {
                font-size: var(--fs-base);
            }
        }
    </style>
</head>

<body>
    <!-- Page Loader Spinner -->
    <div class="page-loader" id="pageLoader">
        <div class="page-loader-logo-container">
            <img src="logo.png" alt="Stranger Things" class="page-loader-logo-img">
        </div>
        <div class="page-loader-text">CARREGANDO</div>
    </div>

    <!-- Grid Background -->
    <div class="grid-background"></div>

    <!-- Top Announcement Bar -->
    <div class="announcement-bar">
        <div class="container">
            <p>‚ú® <strong>OFERTA ESPECIAL:</strong> 20% OFF em todo o site com c√≥digo <strong>STRANGER20</strong> -
                V√°lido at√© 31/01</p>
            <button class="announcement-close" aria-label="Fechar an√∫ncio">&times;</button>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-top">
                <div class="logo">
                    <a href="index.html">
                        <img src="logo.png" alt="Stranger Things Store" class="logo-img">
                    </a>
                </div>
                <div class="header-actions">
                    <!-- Search -->
                    <button class="search-toggle" id="searchToggle" aria-label="Buscar">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" />
                            <path d="m20 20-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </button>
                    <!-- Cart/Bag -->
                    <div class="cart-icon-wrapper">
                        <button class="cart-icon" id="cartBtn" aria-label="Abrir sacola">
                            <span class="cart-count" id="cartCount">0</span>
                            <svg class="bag-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M6 2L3 6V20C3 20.5304 3.21071 21.0391 3.58579 21.4142C3.96086 21.7893 4.46957 22 5 22H19C19.5304 22 20.0391 21.7893 20.4142 21.4142C20.7893 21.0391 21 20.5304 21 20V6L18 2H6Z"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path d="M3 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path
                                    d="M16 10C16 11.0609 15.5786 12.0783 14.8284 12.8284C14.0783 13.5786 13.0609 14 12 14C10.9391 14 9.92172 13.5786 9.17157 12.8284C8.42143 12.0783 8 11.0609 8 10"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </button>
                    </div>
                    <!-- Mobile Menu Toggle -->
                    <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Menu">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="search-bar" id="searchBar">
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Buscar produtos..." class="search-input">
                    <button class="search-submit" aria-label="Buscar">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" />
                            <path d="m20 20-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Main Navigation -->
            <nav class="main-nav" id="mainNav">
                <div class="mobile-nav-header">
                    <div class="mobile-nav-logo">
                        <div class="netflix-logo">NETFLIX</div>
                        <div class="stranger-logo">STRANGER THINGS</div>
                        <div class="series-text">THE ORIGINAL SERIES</div>
                    </div>
                    <button class="mobile-nav-close" id="mobileNavClose">&times;</button>
                </div>

                <ul class="nav-list" id="navList">
                    <!-- Menu din√¢mico ser√° renderizado aqui -->
                </ul>
            </nav>

            <!-- Mobile Nav Overlay -->
            <div class="mobile-nav-overlay" id="mobileNavOverlay"></div>
        </div>
    </header>

    <!-- Collection Header -->
    <section class="collection-header">
        <div class="container">
            <a href="index.html" class="back-link">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                Voltar para Home
            </a>
            <h1 class="collection-title" id="collectionTitle">Carregando...</h1>
            <p class="collection-description" id="collectionDescription"></p>
            <div class="collection-count" id="collectionCount"></div>
        </div>
    </section>

    <!-- Collection Products -->
    <section class="collection-products-section">
        <div class="container">
            <div class="products-grid" id="collectionProducts">
                <!-- Produtos ser√£o carregados aqui -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <!-- Customer Service -->
                <div class="footer-section">
                    <h3>Atendimento</h3>
                    <ul>
                        <li><a href="#">Central de Ajuda</a></li>
                        <li><a href="#">Pedidos e Devolu√ß√µes</a></li>
                        <li><a href="#">Pol√≠tica de Privacidade</a></li>
                        <li><a href="#">Termos de Uso</a></li>
                    </ul>
                </div>

                <!-- Account & Ordering -->
                <div class="footer-section">
                    <h3>Conta e Pedidos</h3>
                    <ul>
                        <li><a href="#">Minha Conta</a></li>
                        <li><a href="#">Pol√≠tica de Envio</a></li>
                        <li><a href="#">Pol√≠tica de Pedidos</a></li>
                    </ul>
                </div>

                <!-- Netflix -->
                <div class="footer-section">
                    <h3>Netflix</h3>
                    <ul>
                        <li><a href="#">Sobre a Netflix Shop</a></li>
                        <li><a href="#">Netflix Streaming</a></li>
                    </ul>
                </div>

                <!-- Newsletter -->
                <div class="footer-section">
                    <h3>Newsletter</h3>
                    <p>Economize 15% na sua primeira compra!</p>
                    <form class="newsletter-form">
                        <input type="email" placeholder="Seu email" required>
                        <button type="submit" class="btn btn-primary">INSCREVER-SE</button>
                    </form>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2024 Stranger Things Store. Todos os direitos reservados.</p>
                <p class="disclaimer">STRANGER THINGS ‚Ñ¢/ ¬© Netflix 2024</p>
            </div>
        </div>
    </footer>

    <!-- Cart Drawer Overlay -->
    <div class="cart-drawer-overlay" id="cartOverlay"></div>

    <!-- Cart Drawer -->
    <div class="cart-drawer" id="cartDrawer">
        <div class="cart-drawer-header">
            <h2>SACOLA</h2>
            <button class="cart-drawer-close" id="closeCart" aria-label="Fechar sacola">&times;</button>
        </div>
        <div class="cart-drawer-body">
            <div id="cartItems"></div>
        </div>
        <div class="cart-drawer-footer">
            <div class="cart-total">
                <span class="cart-total-label">Total:</span>
                <span class="cart-total-value">R$ <span id="cartTotal">0.00</span></span>
            </div>
            <div class="cart-drawer-actions">
                <a href="index.html" class="btn btn-secondary btn-block" id="continueShopping">CONTINUAR COMPRANDO</a>
                <button class="btn btn-primary btn-block" id="checkoutBtn">FINALIZAR COMPRA</button>
            </div>
        </div>
    </div>

    <script>
        // FOR√áAR layout correto IMEDIATAMENTE
        (function () {
            function forceFixedLayout() {
                if (!document.body) return;

                const announcementBar = document.querySelector('.announcement-bar');
                const header = document.querySelector('.header');

                if (announcementBar && !announcementBar.classList.contains('hidden')) {
                    document.body.style.setProperty('padding-top', '48px', 'important');
                    document.body.classList.add('has-announcement');

                    if (header) {
                        header.style.setProperty('top', '48px', 'important');
                        header.style.setProperty('z-index', '1003', 'important');
                        header.classList.add('has-announcement');
                    }

                    if (announcementBar) {
                        announcementBar.style.setProperty('z-index', '1004', 'important');
                        announcementBar.style.setProperty('top', '0', 'important');
                        announcementBar.style.setProperty('height', '48px', 'important');
                    }
                } else {
                    document.body.style.setProperty('padding-top', '0', 'important');
                    document.body.classList.remove('has-announcement');

                    if (header) {
                        header.style.setProperty('top', '0', 'important');
                        header.style.setProperty('z-index', '1003', 'important');
                        header.classList.remove('has-announcement');
                    }
                }
            }

            if (document.body) {
                forceFixedLayout();
            }

            const checkBody = setInterval(function () {
                if (document.body) {
                    clearInterval(checkBody);
                    forceFixedLayout();
                }
            }, 1);

            ['DOMContentLoaded', 'load'].forEach(function (event) {
                document.addEventListener(event, forceFixedLayout);
            });

            let count = 0;
            const forceInterval = setInterval(function () {
                forceFixedLayout();
                count++;
                if (count >= 10) clearInterval(forceInterval);
            }, 100);
        })();

        // Announcement bar close
        document.addEventListener('DOMContentLoaded', () => {
            const announcementClose = document.querySelector('.announcement-close');
            if (announcementClose) {
                announcementClose.addEventListener('click', () => {
                    document.querySelector('.announcement-bar').classList.add('hidden');
                    document.body.classList.remove('has-announcement');
                    document.querySelector('.header').style.top = '0';
                });
            }
        });
    </script>
    <script>
        // INLINED PAGE-LOADER.JS
        (function () {
            'use strict';
            // Page Loader Logic

            const loader = document.getElementById('pageLoader');
            const MIN_LOADING_TIME = 0; // Minimum time to show loader
            const MAX_LOADING_TIME = 5000; // Safety timeout
            const startTime = Date.now();
            let hidden = false;

            function hideLoader() {
                console.log('üôà hideLoader called. Hidden:', hidden, 'Loader:', !!loader);
                if (hidden || !loader) return;

                const elapsed = Date.now() - startTime;
                const remaining = Math.max(0, MIN_LOADING_TIME - elapsed);

                setTimeout(() => {
                    console.log('üôà Hiding loader (timeout executing)');
                    if (hidden) return;
                    hidden = true;

                    loader.classList.add('hidden');
                    document.body.classList.remove('no-scroll'); // Ensure scroll is enabled

                    // Remove from DOM after transition
                    setTimeout(() => {
                        console.log('üôà Loader display: none');
                        loader.style.display = 'none';
                    }, 500);
                }, remaining);
            }

            // Expose functions globally
            window.showPageLoader = function () {
                console.log('üîÑ showPageLoader called');
                if (loader) {
                    hidden = false;
                    loader.style.display = 'flex';
                    loader.classList.remove('hidden');
                    loader.classList.add('active');
                    document.body.classList.add('no-scroll');
                }
            };

            window.hidePageLoader = hideLoader;

            // Safety timeout
            setTimeout(hideLoader, MAX_LOADING_TIME);

            // If script runs late and everything is loaded, try to hide (but script.js should handle it for products)
            // We will leave it active until script.js calls hidePageLoader() or timeout happens.
        })();
    </script>
    <script>
        // INLINED COLLECTION-PAGE.JS
        console.log('üîπ INLINE COLLECTION SCRIPT START');
        // Collection Page JavaScript
        // API Base URL logic handled by script.js or fallback here
        if (typeof window.API_BASE === 'undefined') {
            window.API_BASE = window.location.origin;
            window.API_URL = `${window.API_BASE}/api`;
        }

        // Get collection slug from URL
        const urlParams = new URLSearchParams(window.location.search);
        const collectionSlug = urlParams.get('slug');
        console.log('üîπ Collection Page: Slug detected:', collectionSlug);

        // Safety Timeout to ensure loader goes away even if script hangs
        setTimeout(() => {
            console.warn('‚ö†Ô∏è Safety Timeout: Forcing loader hide after 5s');
            if (window.hidePageLoader) window.hidePageLoader();
        }, 5000);

        let currentCollection = null;
        let collectionProducts = [];
        let currentView = null; // 'grid' ou 'carousel'

        // Load collection and products
        async function loadCollectionPage() {
            if (!collectionSlug) {
                console.error('Sem slug na URL');
                document.getElementById('collectionTitle').textContent = 'Erro';
                document.getElementById('collectionDescription').textContent = 'Cole√ß√£o n√£o especificada.';
                if (window.hidePageLoader) window.hidePageLoader();
                // window.location.href = 'index.html';
                return;
            }

            try {
                // Load all collections
                console.log('üîπ Collection Page: Fetching collections...');
                const collectionsResponse = await fetch(`${window.API_URL}/collections`);
                if (!collectionsResponse.ok) {
                    throw new Error('Erro ao carregar cole√ß√µes');
                }
                const collections = await collectionsResponse.json();
                console.log('üîπ Collection Page: Collections loaded:', collections.length);

                // Find the collection by slug
                currentCollection = collections.find(c => c.slug === collectionSlug);

                if (!currentCollection) {
                    console.error('Cole√ß√£o n√£o encontrada:', collectionSlug);
                    document.getElementById('collectionTitle').textContent = 'Cole√ß√£o n√£o encontrada';
                    document.getElementById('collectionDescription').textContent = 'A cole√ß√£o que voc√™ procura n√£o existe ou foi removida.';
                    // Don't redirect to prevent loops
                    // window.location.href = 'index.html';
                    if (window.hidePageLoader) window.hidePageLoader();
                    return;
                }

                // Definir visualiza√ß√£o inicial baseada no default_view do admin
                currentView = currentCollection.default_view || 'grid';

                // Load all products
                console.log('üîπ Collection Page: Fetching products...');
                const productsResponse = await fetch(`${window.API_URL}/products`);
                if (!productsResponse.ok) {
                    throw new Error('Erro ao carregar produtos');
                }
                const allProducts = await productsResponse.json();
                console.log('üîπ Collection Page: Products loaded:', allProducts.length);

                // Filter products by collection - com valida√ß√£o robusta
                collectionProducts = allProducts.filter(p => {
                    let collections = p.collections || [];
                    if (typeof collections === 'string') {
                        try {
                            collections = JSON.parse(collections);
                        } catch (e) {
                            // Se parse falhar, tratar como string √∫nica
                            collections = [collections];
                        }
                    }

                    // Verificar se √© array antes de usar includes
                    if (!Array.isArray(collections)) {
                        collections = [collections];
                    }

                    // Check explicit collection name match
                    if (collections.includes(currentCollection.name)) return true;

                    // Check category match (fallback for seeded products)
                    // funko-seeder uses category = 'stranger-things-funkos' (slug)
                    if (p.category === collectionSlug) return true;
                    if (p.category === currentCollection.name) return true;

                    return false;
                });

                // Render page
                console.log('üîπ Collection Page: Rendering...');
                renderCollectionHeader();
                renderViewToggle();
                renderCollectionProducts();

                console.log('üîπ Collection Page: Render complete. Hiding loader.');
                // üü¢ FIX: Hide loader after successful render
                if (window.hidePageLoader) {
                    window.hidePageLoader();
                }

            } catch (error) {
                console.error('‚ùå Collection Page Error:', error);
                document.getElementById('collectionTitle').textContent = 'Erro ao carregar cole√ß√£o';
                document.getElementById('collectionDescription').textContent = 'N√£o foi poss√≠vel carregar os produtos desta cole√ß√£o.';

                // üü¢ FIX: Hide loader even on error so user is not stuck
                if (window.hidePageLoader) {
                    window.hidePageLoader();
                }
            }
        }

        // Render collection header
        function renderCollectionHeader() {
            document.getElementById('collectionTitle').textContent = currentCollection.name.toUpperCase();
            document.getElementById('collectionDescription').textContent = currentCollection.description || '';
            document.getElementById('collectionCount').textContent = `${collectionProducts.length} ${collectionProducts.length === 1 ? 'PRODUTO' : 'PRODUTOS'}`;
            document.getElementById('pageTitle').textContent = `${currentCollection.name} - Stranger Things Store`;
        }

        // Renderizar bot√µes de altern√¢ncia de visualiza√ß√£o
        function renderViewToggle() {
            const header = document.querySelector('.collection-header .container');

            // Remover toggle anterior se existir
            const existingToggle = document.getElementById('viewToggle');
            if (existingToggle) {
                existingToggle.remove();
            }

            const toggleHTML = `
                <div id="viewToggle" style="display: flex; justify-content: center; gap: 12px; margin-top: 24px;">
                    <button 
                        class="view-toggle-btn ${currentView === 'grid' ? 'active' : ''}" 
                        onclick="changeView('grid')"
                        style="padding: 12px 24px; background: ${currentView === 'grid' ? 'var(--netflix-red)' : 'transparent'}; color: white; border: 2px solid var(--netflix-red); border-radius: 4px; cursor: pointer; font-family: var(--font-teko); font-size: 16px; text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px;"
                    >
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                        Grid
                    </button>
                    <button 
                        class="view-toggle-btn ${currentView === 'carousel' ? 'active' : ''}" 
                        onclick="changeView('carousel')"
                        style="padding: 12px 24px; background: ${currentView === 'carousel' ? 'var(--netflix-red)' : 'transparent'}; color: white; border: 2px solid var(--netflix-red); border-radius: 4px; cursor: pointer; font-family: var(--font-teko); font-size: 16px; text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px;"
                    >
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
                            <rect x="2" y="6" width="20" height="12" rx="2"></rect>
                            <path d="M12 6v12"></path>
                            <path d="M8 6v12"></path>
                            <path d="M16 6v12"></path>
                        </svg>
                        Carrossel
                    </button>
                </div>
            `;

            header.insertAdjacentHTML('beforeend', toggleHTML);
        }

        // Fun√ß√£o para trocar visualiza√ß√£o (chamada pelos bot√µes)
        function changeView(newView) {
            currentView = newView;
            renderViewToggle();
            renderCollectionProducts();
        }

        // Tornar a fun√ß√£o global
        window.changeView = changeView;

        // Render collection products
        function renderCollectionProducts() {
            const container = document.getElementById('collectionProducts');

            if (!container) return;

            if (collectionProducts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: var(--spacing-3xl); color: var(--text-gray);">
                        <p style="font-size: var(--fs-xl);">Nenhum produto encontrado nesta cole√ß√£o.</p>
                    </div>
                `;
                return;
            }

            // Alterar classe do container baseado na visualiza√ß√£o
            if (currentView === 'carousel') {
                container.className = 'products-carousel';
                container.style.display = 'flex';
                container.style.overflowX = 'auto';
                container.style.gap = '20px';
                container.style.scrollSnapType = 'x mandatory';
                container.style.scrollBehavior = 'smooth';
                container.style.paddingBottom = '20px';
            } else {
                container.className = 'products-grid';
                container.style.display = '';
                container.style.overflowX = '';
                container.style.gap = '';
                container.style.scrollSnapType = '';
                container.style.scrollBehavior = '';
            }

            container.innerHTML = collectionProducts.map(product => {
                const price = parseFloat(product.price) || 0;
                const originalPrice = product.original_price ? parseFloat(product.original_price) : null;
                const hasDiscount = originalPrice && originalPrice > price;
                const discountPercent = hasDiscount ? Math.round(((originalPrice - price) / originalPrice) * 100) : 0;

                // Calcular parcelamento (at√© 3x sem juros)
                const installmentValue = (price / 3).toFixed(2).replace('.', ',');
                const pixDiscount = (price * 0.95).toFixed(2).replace('.', ','); // 5% desconto no PIX

                const cardStyle = currentView === 'carousel' ? 'min-width: 300px; scroll-snap-align: start;' : '';

                return `
                    <a href="product.html?id=${product.id}" class="product-card" data-product-id="${product.id}" style="${cardStyle}">
                        <div class="product-image-wrapper">
                            ${hasDiscount && discountPercent > 0 ? `<span class="product-badge discount">-${discountPercent}%</span>` : ''}
                            <div class="product-image">
                                ${product.image_url ?
                        `<img src="${product.image_url}" alt="${product.name}" loading="lazy">` :
                        '<div style="font-size: 3rem; display: flex; align-items: center; justify-content: center; height: 100%;">üì¶</div>'
                    }
                            </div>
                        </div>
                        <div class="product-info">
                            <h3 class="product-name">${product.name}</h3>
                            <p class="product-description">${product.description || ''}</p>
                            <div class="product-price">
                                ${hasDiscount ? `<span class="product-price-old">R$ ${originalPrice.toFixed(2).replace('.', ',')}</span>` : ''}
                                <span>R$ ${price.toFixed(2).replace('.', ',')}</span>
                            </div>
                            <div class="product-payment-info">
                                <div class="payment-installment">3x de R$ ${installmentValue} sem juros</div>
                                <div class="payment-pix">R$ ${pixDiscount} no PIX (5% OFF)</div>
                            </div>
                        </div>
                    </a>
                `;
            }).join('');
        }

        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', () => {
            loadCollectionPage();

            // Load cart from API on page load
            if (typeof window.loadCartFromAPI === 'function') {
                window.loadCartFromAPI();
            }
        });
    </script>
    <script src="script.js?v=2.6"></script>
</body>

</html>